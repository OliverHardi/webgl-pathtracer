// cie lookup table to convert from wavelength to XYZ
// based on the CIE 1931 color space
// https://en.wikipedia.org/wiki/CIE_1931_color_space

const cie = new Float32Array([
    0.001368000000,0.0000390000000,0.006450001000,0,
    0.001502050000,0.0000428264000,0.007083216000,0,
    0.001642328000,0.0000469146000,0.007745488000,0,
    0.001802382000,0.0000515896000,0.008501152000,0,
    0.001995757000,0.0000571764000,0.009414544000,0,
    0.002236000000,0.0000640000000,0.010549990000,0,
    0.002535385000,0.0000723442100,0.011965800000,0,
    0.002892603000,0.0000822122400,0.013655870000,0,
    0.003300829000,0.0000935081600,0.015588050000,0,
    0.003753236000,0.0001061361000,0.017730150000,0,
    0.004243000000,0.0001200000000,0.020050010000,0,
    0.004762389000,0.0001349840000,0.022511360000,0,
    0.005330048000,0.0001514920000,0.025202880000,0,
    0.005978712000,0.0001702080000,0.028279720000,0,
    0.006741117000,0.0001918160000,0.031897040000,0,
    0.007650000000,0.0002170000000,0.036210000000,0,
    0.008751373000,0.0002469067000,0.041437710000,0,
    0.010028880000,0.0002812400000,0.047503720000,0,
    0.011421700000,0.0003185200000,0.054119880000,0,
    0.012869010000,0.0003572667000,0.060998030000,0,
    0.014310000000,0.0003960000000,0.067850010000,0,
    0.015704430000,0.0004337147000,0.074486320000,0,
    0.017147440000,0.0004730240000,0.081361560000,0,
    0.018781220000,0.0005178760000,0.089153640000,0,
    0.020748010000,0.0005722187000,0.098540480000,0,
    0.023190000000,0.0006400000000,0.110200000000,0,
    0.026207360000,0.0007245600000,0.124613300000,0,
    0.029782480000,0.0008255000000,0.141701700000,0,
    0.033880920000,0.0009411600000,0.161303500000,0,
    0.038468240000,0.0010698800000,0.183256800000,0,
    0.043510000000,0.0012100000000,0.207400000000,0,
    0.048995600000,0.0013620910000,0.233692100000,0,
    0.055022600000,0.0015307520000,0.262611400000,0,
    0.061718800000,0.0017203680000,0.294774600000,0,
    0.069212000000,0.0019353230000,0.330798500000,0,
    0.077630000000,0.0021800000000,0.371300000000,0,
    0.086958110000,0.0024548000000,0.416209100000,0,
    0.097176720000,0.0027640000000,0.465464200000,0,
    0.108406300000,0.0031178000000,0.519694800000,0,
    0.120767200000,0.0035264000000,0.579530300000,0,
    0.134380000000,0.0040000000000,0.645600000000,0,
    0.149358200000,0.0045462400000,0.718483800000,0,
    0.165395700000,0.0051593200000,0.796713300000,0,
    0.181983100000,0.0058292800000,0.877845900000,0,
    0.198611000000,0.0065461600000,0.959439000000,0,
    0.214770000000,0.0073000000000,1.039050100000,0,
    0.230186800000,0.0080865070000,1.115367300000,0,
    0.244879700000,0.0089087200000,1.188497100000,0,
    0.258777300000,0.0097676800000,1.258123300000,0,
    0.271807900000,0.0106644300000,1.323929600000,0,
    0.283900000000,0.0116000000000,1.385600000000,0,
    0.294943800000,0.0125731700000,1.442635200000,0,
    0.304896500000,0.0135827200000,1.494803500000,0,
    0.313787300000,0.0146296800000,1.542190300000,0,
    0.321645400000,0.0157150900000,1.584880700000,0,
    0.328500000000,0.0168400000000,1.622960000000,0,
    0.334351300000,0.0180073600000,1.656404800000,0,
    0.339210100000,0.0192144800000,1.685295900000,0,
    0.343121300000,0.0204539200000,1.709874500000,0,
    0.346129600000,0.0217182400000,1.730382100000,0,
    0.348280000000,0.0230000000000,1.747060000000,0,
    0.349599900000,0.0242946100000,1.760044600000,0,
    0.350147400000,0.0256102400000,1.769623300000,0,
    0.350013000000,0.0269585700000,1.776263700000,0,
    0.349287000000,0.0283512500000,1.780433400000,0,
    0.348060000000,0.0298000000000,1.782600000000,0,
    0.346373300000,0.0313108300000,1.782968200000,0,
    0.344262400000,0.0328836800000,1.781699800000,0,
    0.341808800000,0.0345211200000,1.779198200000,0,
    0.339094100000,0.0362257100000,1.775867100000,0,
    0.336200000000,0.0380000000000,1.772110000000,0,
    0.333197700000,0.0398466700000,1.768258900000,0,
    0.330041100000,0.0417680000000,1.764039000000,0,
    0.326635700000,0.0437660000000,1.758943800000,0,
    0.322886800000,0.0458426700000,1.752466300000,0,
    0.318700000000,0.0480000000000,1.744100000000,0,
    0.314025100000,0.0502436800000,1.733559500000,0,
    0.308884000000,0.0525730400000,1.720858100000,0,
    0.303290400000,0.0549805600000,1.705936900000,0,
    0.297257900000,0.0574587200000,1.688737200000,0,
    0.290800000000,0.0600000000000,1.669200000000,0,
    0.283970100000,0.0626019700000,1.647528700000,0,
    0.276721400000,0.0652775200000,1.623412700000,0,
    0.268917800000,0.0680420800000,1.596022300000,0,
    0.260422700000,0.0709110900000,1.564528000000,0,
    0.251100000000,0.0739000000000,1.528100000000,0,
    0.240847500000,0.0770160000000,1.486111400000,0,
    0.229851200000,0.0802664000000,1.439521500000,0,
    0.218407200000,0.0836668000000,1.389879900000,0,
    0.206811500000,0.0872328000000,1.338736200000,0,
    0.195360000000,0.0909800000000,1.287640000000,0,
    0.184213600000,0.0949175500000,1.237422300000,0,
    0.173327300000,0.0990458400000,1.187824300000,0,
    0.162688100000,0.1033674000000,1.138761100000,0,
    0.152283300000,0.1078846000000,1.090148000000,0,
    0.142100000000,0.1126000000000,1.041900000000,0,
    0.132178600000,0.1175320000000,0.994197600000,0,
    0.122569600000,0.1226744000000,0.947347300000,0,
    0.113275200000,0.1279928000000,0.901453100000,0,
    0.104297900000,0.1334528000000,0.856619300000,0,
    0.095640000000,0.1390200000000,0.812950100000,0,
    0.087299550000,0.1446764000000,0.770517300000,0,
    0.079308040000,0.1504693000000,0.729444800000,0,
    0.071717760000,0.1564619000000,0.689913600000,0,
    0.064580990000,0.1627177000000,0.652104900000,0,
    0.057950010000,0.1693000000000,0.616200000000,0,
    0.051862110000,0.1762431000000,0.582328600000,0,
    0.046281520000,0.1835581000000,0.550416200000,0,
    0.041150880000,0.1912735000000,0.520337600000,0,
    0.036412830000,0.1994180000000,0.491967300000,0,
    0.032010000000,0.2080200000000,0.465180000000,0,
    0.027917200000,0.2171199000000,0.439924600000,0,
    0.024144400000,0.2267345000000,0.416183600000,0,
    0.020687000000,0.2368571000000,0.393882200000,0,
    0.017540400000,0.2474812000000,0.372945900000,0,
    0.014700000000,0.2586000000000,0.353300000000,0,
    0.012161790000,0.2701849000000,0.334857800000,0,
    0.009919960000,0.2822939000000,0.317552100000,0,
    0.007967240000,0.2950505000000,0.301337500000,0,
    0.006296346000,0.3085780000000,0.286168600000,0,
    0.004900000000,0.3230000000000,0.272000000000,0,
    0.003777173000,0.3384021000000,0.258817100000,0,
    0.002945320000,0.3546858000000,0.246483800000,0,
    0.002424880000,0.3716986000000,0.234771800000,0,
    0.002236293000,0.3892875000000,0.223453300000,0,
    0.002400000000,0.4073000000000,0.212300000000,0,
    0.002925520000,0.4256299000000,0.201169200000,0,
    0.003836560000,0.4443096000000,0.190119600000,0,
    0.005174840000,0.4633944000000,0.179225400000,0,
    0.006982080000,0.4829395000000,0.168560800000,0,
    0.009300000000,0.5030000000000,0.158200000000,0,
    0.012149490000,0.5235693000000,0.148138300000,0,
    0.015535880000,0.5445120000000,0.138375800000,0,
    0.019477520000,0.5656900000000,0.128994200000,0,
    0.023992770000,0.5869653000000,0.120075100000,0,
    0.029100000000,0.6082000000000,0.111700000000,0,
    0.034814850000,0.6293456000000,0.103904800000,0,
    0.041120160000,0.6503068000000,0.096667480000,0,
    0.047985040000,0.6708752000000,0.089982720000,0,
    0.055378610000,0.6908424000000,0.083845310000,0,
    0.063270000000,0.7100000000000,0.078249990000,0,
    0.071635010000,0.7281852000000,0.073208990000,0,
    0.080462240000,0.7454636000000,0.068678160000,0,
    0.089739960000,0.7619694000000,0.064567840000,0,
    0.099456450000,0.7778368000000,0.060788350000,0,
    0.109600000000,0.7932000000000,0.057250010000,0,
    0.120167400000,0.8081104000000,0.053904350000,0,
    0.131114500000,0.8224962000000,0.050746640000,0,
    0.142367900000,0.8363068000000,0.047752760000,0,
    0.153854200000,0.8494916000000,0.044898590000,0,
    0.165500000000,0.8620000000000,0.042160000000,0,
    0.177257100000,0.8738108000000,0.039507280000,0,
    0.189140000000,0.8849624000000,0.036935640000,0,
    0.201169400000,0.8954936000000,0.034458360000,0,
    0.213365800000,0.9054432000000,0.032088720000,0,
    0.225749900000,0.9148501000000,0.029840000000,0,
    0.238320900000,0.9237348000000,0.027711810000,0,
    0.251066800000,0.9320924000000,0.025694440000,0,
    0.263992200000,0.9399226000000,0.023787160000,0,
    0.277101700000,0.9472252000000,0.021989250000,0,
    0.290400000000,0.9540000000000,0.020300000000,0,
    0.303891200000,0.9602561000000,0.018718050000,0,
    0.317572600000,0.9660074000000,0.017240360000,0,
    0.331438400000,0.9712606000000,0.015863640000,0,
    0.345482800000,0.9760225000000,0.014584610000,0,
    0.359700000000,0.9803000000000,0.013400000000,0,
    0.374083900000,0.9840924000000,0.012307230000,0,
    0.388639600000,0.9874182000000,0.011301880000,0,
    0.403378400000,0.9903128000000,0.010377920000,0,
    0.418311500000,0.9928116000000,0.009529306000,0,
    0.433449900000,0.9949501000000,0.008749999000,0,
    0.448795300000,0.9967108000000,0.008035200000,0,
    0.464336000000,0.9980983000000,0.007381600000,0,
    0.480064000000,0.9991120000000,0.006785400000,0,
    0.495971300000,0.9997482000000,0.006242800000,0,
    0.512050100000,1.0000000000000,0.005749999000,0,
    0.528295900000,0.9998567000000,0.005303600000,0,
    0.544691600000,0.9993046000000,0.004899800000,0,
    0.561209400000,0.9983255000000,0.004534200000,0,
    0.577821500000,0.9968987000000,0.004202400000,0,
    0.594500000000,0.9950000000000,0.003900000000,0,
    0.611220900000,0.9926005000000,0.003623200000,0,
    0.627975800000,0.9897426000000,0.003370600000,0,
    0.644760200000,0.9864444000000,0.003141400000,0,
    0.661569700000,0.9827241000000,0.002934800000,0,
    0.678400000000,0.9786000000000,0.002749999000,0,
    0.695239200000,0.9740837000000,0.002585200000,0,
    0.712058600000,0.9691712000000,0.002438600000,0,
    0.728828400000,0.9638568000000,0.002309400000,0,
    0.745518800000,0.9581349000000,0.002196800000,0,
    0.762100000000,0.9520000000000,0.002100000000,0,
    0.778543200000,0.9454504000000,0.002017733000,0,
    0.794825600000,0.9384992000000,0.001948200000,0,
    0.810926400000,0.9311628000000,0.001889800000,0,
    0.826824800000,0.9234576000000,0.001840933000,0,
    0.842500000000,0.9154000000000,0.001800000000,0,
    0.857932500000,0.9070064000000,0.001766267000,0,
    0.873081600000,0.8982772000000,0.001737800000,0,
    0.887894400000,0.8892048000000,0.001711200000,0,
    0.902318100000,0.8797816000000,0.001683067000,0,
    0.916300000000,0.8700000000000,0.001650001000,0,
    0.929799500000,0.8598613000000,0.001610133000,0,
    0.942798400000,0.8493920000000,0.001564400000,0,
    0.955277600000,0.8386220000000,0.001513600000,0,
    0.967217900000,0.8275813000000,0.001458533000,0,
    0.978600000000,0.8163000000000,0.001400000000,0,
    0.989385600000,0.8047947000000,0.001336667000,0,
    0.999548800000,0.7930820000000,0.001270000000,0,
    1.009089200000,0.7811920000000,0.001205000000,0,
    1.018006400000,0.7691547000000,0.001146667000,0,
    1.026300000000,0.7570000000000,0.001100000000,0,
    1.033982700000,0.7447541000000,0.001068800000,0,
    1.040986000000,0.7324224000000,0.001049400000,0,
    1.047188000000,0.7200036000000,0.001035600000,0,
    1.052466700000,0.7074965000000,0.001021200000,0,
    1.056700000000,0.6949000000000,0.001000000000,0,
    1.059794400000,0.6822192000000,0.000968640000,0,
    1.061799200000,0.6694716000000,0.000929920000,0,
    1.062806800000,0.6566744000000,0.000886880000,0,
    1.062909600000,0.6438448000000,0.000842560000,0,
    1.062200000000,0.6310000000000,0.000800000000,0,
    1.060735200000,0.6181555000000,0.000760960000,0,
    1.058443600000,0.6053144000000,0.000723680000,0,
    1.055224400000,0.5924756000000,0.000685920000,0,
    1.050976800000,0.5796379000000,0.000645440000,0,
    1.045600000000,0.5668000000000,0.000600000000,0,
    1.039036900000,0.5539611000000,0.000547866700,0,
    1.031360800000,0.5411372000000,0.000491600000,0,
    1.022666200000,0.5283528000000,0.000435400000,0,
    1.013047700000,0.5156323000000,0.000383466700,0,
    1.002600000000,0.5030000000000,0.000340000000,0,
    0.991367500000,0.4904688000000,0.000307253300,0,
    0.979331400000,0.4780304000000,0.000283160000,0,
    0.966491600000,0.4656776000000,0.000265440000,0,
    0.952847900000,0.4534032000000,0.000251813300,0,
    0.938400000000,0.4412000000000,0.000240000000,0,
    0.923194000000,0.4290800000000,0.000229546700,0,
    0.907244000000,0.4170360000000,0.000220640000,0,
    0.890502000000,0.4050320000000,0.000211960000,0,
    0.872920000000,0.3930320000000,0.000202186700,0,
    0.854449900000,0.3810000000000,0.000190000000,0,
    0.835084000000,0.3689184000000,0.000174213300,0,
    0.814946000000,0.3568272000000,0.000155640000,0,
    0.794186000000,0.3447768000000,0.000135960000,0,
    0.772954000000,0.3328176000000,0.000116853300,0,
    0.751400000000,0.3210000000000,0.000100000000,0,
    0.729583600000,0.3093381000000,0.000086133330,0,
    0.707588800000,0.2978504000000,0.000074600000,0,
    0.685602200000,0.2865936000000,0.000065000000,0,
    0.663810400000,0.2756245000000,0.000056933330,0,
    0.642400000000,0.2650000000000,0.000049999990,0,
    0.621514900000,0.2547632000000,0.000044160000,0,
    0.601113800000,0.2448896000000,0.000039480000,0,
    0.581105200000,0.2353344000000,0.000035720000,0,
    0.561397700000,0.2260528000000,0.000032640000,0,
    0.541900000000,0.2170000000000,0.000030000000,0,
    0.522599500000,0.2081616000000,0.000027653330,0,
    0.503546400000,0.1995488000000,0.000025560000,0,
    0.484743600000,0.1911552000000,0.000023640000,0,
    0.466193900000,0.1829744000000,0.000021813330,0,
    0.447900000000,0.1750000000000,0.000020000000,0,
    0.429861300000,0.1672235000000,0.000018133330,0,
    0.412098000000,0.1596464000000,0.000016200000,0,
    0.394644000000,0.1522776000000,0.000014200000,0,
    0.377533300000,0.1451259000000,0.000012133330,0,
    0.360800000000,0.1382000000000,0.000010000000,0,
    0.344456300000,0.1315003000000,0.000007733333,0,
    0.328516800000,0.1250248000000,0.000005400000,0,
    0.313019200000,0.1187792000000,0.000003200000,0,
    0.298001100000,0.1127691000000,0.000001333333,0,
    0.283500000000,0.1070000000000,0.000000000000,0,
    0.269544800000,0.1014762000000,0.000000000000,0,
    0.256118400000,0.0961886400000,0.000000000000,0,
    0.243189600000,0.0911229600000,0.000000000000,0,
    0.230727200000,0.0862648500000,0.000000000000,0,
    0.218700000000,0.0816000000000,0.000000000000,0,
    0.207097100000,0.0771206400000,0.000000000000,0,
    0.195923200000,0.0728255200000,0.000000000000,0,
    0.185170800000,0.0687100800000,0.000000000000,0,
    0.174832300000,0.0647697600000,0.000000000000,0,
    0.164900000000,0.0610000000000,0.000000000000,0,
    0.155366700000,0.0573962100000,0.000000000000,0,
    0.146230000000,0.0539550400000,0.000000000000,0,
    0.137490000000,0.0506737600000,0.000000000000,0,
    0.129146700000,0.0475496500000,0.000000000000,0,
    0.121200000000,0.0445800000000,0.000000000000,0,
    0.113639700000,0.0417587200000,0.000000000000,0,
    0.106465000000,0.0390849600000,0.000000000000,0,
    0.099690440000,0.0365638400000,0.000000000000,0,
    0.093330610000,0.0342004800000,0.000000000000,0,
    0.087400000000,0.0320000000000,0.000000000000,0,
    0.081900960000,0.0299626100000,0.000000000000,0,
    0.076804280000,0.0280766400000,0.000000000000,0,
    0.072077120000,0.0263293600000,0.000000000000,0,
    0.067686640000,0.0247080500000,0.000000000000,0,
    0.063600000000,0.0232000000000,0.000000000000,0,
    0.059806850000,0.0218007700000,0.000000000000,0,
    0.056282160000,0.0205011200000,0.000000000000,0,
    0.052971040000,0.0192810800000,0.000000000000,0,
    0.049818610000,0.0181206900000,0.000000000000,0,
    0.046770000000,0.0170000000000,0.000000000000,0,
    0.043784050000,0.0159037900000,0.000000000000,0,
    0.040875360000,0.0148371800000,0.000000000000,0,
    0.038072640000,0.0138106800000,0.000000000000,0,
    0.035404610000,0.0128347800000,0.000000000000,0,
    0.032900000000,0.0119200000000,0.000000000000,0,
    0.030564190000,0.0110683100000,0.000000000000,0,
    0.028380560000,0.0102733900000,0.000000000000,0,
    0.026344840000,0.0095333110000,0.000000000000,0,
    0.024452750000,0.0088461570000,0.000000000000,0,
    0.022700000000,0.0082100000000,0.000000000000,0,
    0.021084290000,0.0076237810000,0.000000000000,0,
    0.019599880000,0.0070854240000,0.000000000000,0,
    0.018237320000,0.0065914760000,0.000000000000,0,
    0.016987170000,0.0061384850000,0.000000000000,0,
    0.015840000000,0.0057230000000,0.000000000000,0,
    0.014790640000,0.0053430590000,0.000000000000,0,
    0.013831320000,0.0049957960000,0.000000000000,0,
    0.012948680000,0.0046764040000,0.000000000000,0,
    0.012129200000,0.0043800750000,0.000000000000,0,
    0.011359160000,0.0041020000000,0.000000000000,0
]);

for(let i = 0; i < cie.length; i++){
    cie[i] *= d65[Math.floor(i/4)*3];
}